<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ë£¨ë‚˜ëƒ¥</title>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
import { getFirestore, collection, doc, onSnapshot, setDoc, deleteDoc, addDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCwxxfS_LAE4B235By47Nz6kLk7WdwlxCA",
  authDomain: "toto-first-app-742ea.firebaseapp.com",
  projectId: "toto-first-app-742ea",
  storageBucket: "toto-first-app-742ea.firebasestorage.app",
  messagingSenderId: "660038552001",
  appId: "1:660038552001:web:13b0cea1ec1a27422c4740"
};

const fireApp = initializeApp(firebaseConfig);
const db = getFirestore(fireApp);

let currentRoomId = 'default-room';
let routineUnsub = null;
let gbUnsub = null;

// â”€â”€ ë£¨í‹´ ì‹¤ì‹œê°„ êµ¬ë… â”€â”€
function subscribeRoutines(roomId) {
  if (routineUnsub) routineUnsub();
  const q = query(collection(db, 'rooms', roomId, 'routines'));
  routineUnsub = onSnapshot(q, (snapshot) => {
    window.routines = [];
    snapshot.forEach(d => window.routines.push({ id: d.id, ...d.data() }));
    window.routines.sort((a, b) => (a.createdAt || 0) - (b.createdAt || 0));
    if (document.getElementById('rList')) window.renderRoutines();
  });
}

// â”€â”€ ë°©ëª…ë¡ ì‹¤ì‹œê°„ êµ¬ë… â”€â”€
function subscribeGuestbook(roomId) {
  if (gbUnsub) gbUnsub();
  const q = query(collection(db, 'rooms', roomId, 'guestbook'), orderBy('createdAt', 'desc'));
  gbUnsub = onSnapshot(q, (snapshot) => {
    window.gbPosts = [];
    snapshot.forEach(d => {
      const data = d.data();
      window.gbPosts.push({
        id: d.id,
        name: data.name,
        text: data.text,
        createdAt: data.createdAt
      });
    });
    if (document.getElementById('gbList')) window.renderGuestbook();
  });
}

// â”€â”€ ë£¨í‹´ ì¶”ê°€ â”€â”€
window.fbAddRoutine = async (name, time, emo) => {
  await addDoc(collection(db, 'rooms', currentRoomId, 'routines'), {
    name, time, emo, done: false, createdAt: Date.now()
  });
};

// â”€â”€ ë£¨í‹´ í† ê¸€ â”€â”€
window.fbToggleDone = async (id, done) => {
  await setDoc(doc(db, 'rooms', currentRoomId, 'routines', id), { done }, { merge: true });
};

// â”€â”€ ë£¨í‹´ ì‚­ì œ â”€â”€
window.fbDeleteRoutine = async (id) => {
  await deleteDoc(doc(db, 'rooms', currentRoomId, 'routines', id));
};

// â”€â”€ ë°©ëª…ë¡ ì‘ì„± â”€â”€
window.fbPostGuestbook = async (name, text) => {
  await addDoc(collection(db, 'rooms', currentRoomId, 'guestbook'), {
    name, text, createdAt: serverTimestamp()
  });
};

// â”€â”€ ë°© ì°¸ì—¬ â”€â”€
window.fbJoinRoom = (code) => {
  currentRoomId = code.toLowerCase();
  subscribeRoutines(currentRoomId);
  subscribeGuestbook(currentRoomId);
};

// â”€â”€ í˜„ì¬ ë°© ì½”ë“œ ë°˜í™˜ â”€â”€
window.fbGetRoomId = () => currentRoomId;

// â”€â”€ ì•± ì‹œì‘ â”€â”€
window.fbInit = (roomId) => {
  currentRoomId = roomId;
  subscribeRoutines(currentRoomId);
  subscribeGuestbook(currentRoomId);
};
</script>

<style>
:root {
  --cream:#fdf8f2; --warm:#fff9f4; --peach:#f5c9a0;
  --orange:#e8956a; --terra:#d4714e; --yellow:#e8c240;
  --sage:#9dbfa8; --ink:#3d2e1e; --ink2:#6b5040;
  --muted:#b8a898; --shadow:rgba(61,46,30,0.09);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;font-family:'Noto Sans KR',sans-serif;background:#1a1208;overflow:hidden}
.app{position:fixed;inset:0;background:var(--cream);display:flex;flex-direction:column;max-width:480px;margin:0 auto;overflow:hidden}
.screen{display:none;flex-direction:column;flex:1;overflow:hidden;position:relative}
.screen.active{display:flex}
.scroll-area{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;scrollbar-width:none;padding-bottom:16px}
.scroll-area::-webkit-scrollbar{display:none}

/* í•˜ë‹¨ ë„¤ë¹„ */
.bottom-nav{flex-shrink:0;height:72px;background:var(--warm);border-top:1.5px solid rgba(61,46,30,0.07);display:flex;align-items:flex-start;padding-top:10px;padding-bottom:env(safe-area-inset-bottom,0px);box-shadow:0 -6px 24px rgba(61,46,30,0.06);z-index:10}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;transition:all .18s;padding:2px 0}
.nav-icon{font-size:22px;line-height:1}
.nav-label{font-size:10px;font-weight:500;color:var(--muted)}
.nav-item.active .nav-icon{transform:scale(1.15) translateY(-2px)}
.nav-item.active .nav-label{color:var(--terra);font-weight:700}

/* í™ˆ íˆì–´ë¡œ */
.hero{background:linear-gradient(160deg,#fdefd8,#f8cba8);padding:14px 20px 24px;position:relative;overflow:hidden;flex-shrink:0}
.hero::before{content:'';position:absolute;top:-30px;right:-30px;width:120px;height:120px;background:radial-gradient(circle,rgba(245,217,120,.45) 0%,transparent 70%);border-radius:50%}
.hero-row{display:flex;justify-content:space-between;align-items:flex-start}
.hero-date{font-size:11px;color:var(--ink2);font-weight:500;margin-bottom:4px}
.hero-name{font-family:'Nanum Myeongjo',serif;font-size:22px;color:var(--ink);font-weight:700;line-height:1.3}
.hero-name span{color:var(--terra)}
.hero-cat{font-size:56px;line-height:1;cursor:pointer;animation:bob 3s ease-in-out infinite;filter:drop-shadow(1px 3px 6px rgba(61,46,30,.15));flex-shrink:0}
@keyframes bob{0%,100%{transform:translateY(0) rotate(-2deg)}50%{transform:translateY(-5px) rotate(2deg)}}
.prog-area{margin-top:12px}
.prog-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px}
.prog-label{font-size:12px;color:var(--ink2);font-weight:500}
.prog-pct{font-size:16px;color:var(--terra);font-weight:700;font-family:'Nanum Myeongjo',serif}
.prog-track{height:9px;background:rgba(61,46,30,.1);border-radius:9px;overflow:hidden}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--orange),var(--yellow));border-radius:9px;width:0%;transition:width 1s cubic-bezier(0.34,1.56,0.64,1)}

/* AI ì¹´ë“œ */
.ai-card{margin:12px 16px 0;background:linear-gradient(135deg,#fff4e8,#fff8f2);border:1.5px solid rgba(232,149,106,.22);border-radius:18px;padding:13px 16px;display:flex;gap:10px;align-items:flex-start;flex-shrink:0}
.ai-emo{font-size:28px;flex-shrink:0}
.ai-badge{display:inline-block;background:var(--orange);color:#fff;font-size:9px;font-weight:700;padding:2px 7px;border-radius:20px;margin-bottom:5px}
.ai-msg{font-size:12.5px;color:var(--ink);line-height:1.6}

/* ì„¹ì…˜ */
.sec-row{display:flex;justify-content:space-between;align-items:center;padding:14px 16px 10px;flex-shrink:0}
.sec-title{font-family:'Nanum Myeongjo',serif;font-size:17px;color:var(--ink);font-weight:700}
.edit-btn{background:#fff;border:1.5px solid rgba(61,46,30,.1);border-radius:18px;padding:6px 13px;font-size:11px;color:var(--ink2);font-weight:600;cursor:pointer;font-family:'Noto Sans KR',sans-serif;box-shadow:0 1px 6px var(--shadow);transition:all .2s}
.edit-btn.on{background:var(--terra);color:#fff;border-color:var(--terra)}

/* ë£¨í‹´ ì¹´ë“œ */
.r-list{padding:0 16px;display:flex;flex-direction:column;gap:9px}
.r-card{background:#fff;border-radius:18px;padding:13px 14px;display:flex;align-items:center;gap:11px;box-shadow:0 2px 12px var(--shadow);border:1.5px solid rgba(61,46,30,.04);position:relative;overflow:hidden;animation:popIn .35s ease both;transition:border-color .2s}
.r-card.done{border-color:rgba(157,191,168,.35)}
.r-card.done::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(245,217,120,.12),transparent);border-radius:inherit;pointer-events:none}
.r-chk{width:34px;height:34px;border-radius:50%;border:2.5px solid var(--peach);background:#fff;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;cursor:pointer;transition:all .3s cubic-bezier(0.34,1.56,0.64,1)}
.r-card.done .r-chk{background:var(--sage);border-color:var(--sage);box-shadow:0 3px 10px rgba(157,191,168,.4)}
.r-info{flex:1;min-width:0;cursor:pointer}
.r-name{font-size:14px;font-weight:600;color:var(--ink);margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.r-card.done .r-name{color:var(--muted);text-decoration:line-through}
.r-time{font-size:11px;color:var(--muted)}
.r-emo{font-size:22px;flex-shrink:0}
.r-del{width:30px;height:30px;border-radius:50%;background:rgba(212,113,78,.07);border:1.5px solid rgba(212,113,78,.18);display:flex;align-items:center;justify-content:center;font-size:14px;cursor:pointer;flex-shrink:0;opacity:0;pointer-events:none;transition:all .2s;position:relative;z-index:2}
.edit-mode .r-del{opacity:1;pointer-events:all}

/* ì¶”ê°€/ê³µìœ  ë²„íŠ¼ */
.add-btn{margin:10px 16px 0;background:linear-gradient(135deg,#fff4d6,#fdecc4);border:2px dashed rgba(232,194,64,.45);border-radius:18px;padding:13px 16px;display:flex;align-items:center;gap:11px;cursor:pointer;transition:transform .15s}
.add-btn:active{transform:scale(0.97)}
.add-ico{width:34px;height:34px;background:var(--yellow);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;color:#fff;font-weight:700;flex-shrink:0;box-shadow:0 3px 10px rgba(232,194,64,.35)}
.add-txt{font-size:13px;color:var(--ink2);font-weight:600}
.add-sub{font-size:11px;color:var(--muted);margin-top:1px}
.share-banner{margin:10px 16px 16px;background:linear-gradient(135deg,#eef6f2,#e4f0eb);border:1.5px solid rgba(157,191,168,.38);border-radius:18px;padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:transform .15s;box-shadow:0 3px 12px rgba(157,191,168,.1)}
.share-banner:active{transform:scale(0.98)}
.share-ico{width:42px;height:42px;background:var(--sage);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;box-shadow:0 3px 10px rgba(157,191,168,.3)}
.share-info{flex:1}
.share-ttl{font-size:13px;font-weight:700;color:var(--ink);margin-bottom:2px}
.share-sub{font-size:11px;color:var(--ink2);line-height:1.4}

/* ê¸°ë¡ */
.rec-hero{background:linear-gradient(160deg,#f5c9a0,#f4a96a);padding:14px 20px 44px;position:relative;overflow:hidden;flex-shrink:0}
.rec-hero::after{content:'';position:absolute;bottom:-18px;left:0;right:0;height:36px;background:#fef5ee;border-radius:50% 50% 0 0 / 28px}
.rec-deco{position:absolute;top:8px;right:16px;font-size:60px;opacity:.22;transform:rotate(15deg)}
.rec-lbl{font-size:10px;color:rgba(61,46,30,.55);letter-spacing:.1em;text-transform:uppercase;margin-bottom:5px;font-weight:600}
.rec-ttl{font-family:'Nanum Myeongjo',serif;font-size:24px;color:var(--ink);font-weight:800}
.inp-card{background:#fff;border-radius:20px;padding:18px;margin-bottom:12px;box-shadow:0 3px 16px var(--shadow)}
.inp-lbl{font-size:11px;color:var(--ink2);font-weight:700;letter-spacing:.06em;text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.inp-lbl span{font-size:16px}
.txt-inp{width:100%;border:none;outline:none;font-family:'Nanum Myeongjo',serif;font-size:16px;color:var(--ink);background:transparent;resize:none;line-height:1.65;min-height:70px}
.txt-inp::placeholder{color:#d4c4b4}
.char-ct{font-size:11px;color:var(--muted);text-align:right;margin-top:6px}
.mood-row{display:flex;gap:6px}
.mood-btn{flex:1;background:#fff8f2;border:2px solid rgba(61,46,30,.07);border-radius:14px;padding:10px 4px;text-align:center;cursor:pointer;font-size:20px;display:flex;flex-direction:column;align-items:center;gap:4px;transition:all .2s cubic-bezier(0.34,1.56,0.64,1)}
.mood-btn span{font-size:9px;color:var(--muted);font-weight:600}
.mood-btn.sel{background:linear-gradient(135deg,#fff4d6,#ffecc4);border-color:var(--yellow);transform:scale(1.07) translateY(-2px);box-shadow:0 5px 14px rgba(232,194,64,.22)}
.save-btn{width:100%;background:linear-gradient(135deg,var(--terra),var(--orange));color:#fff;border:none;border-radius:18px;padding:16px;font-size:15px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;box-shadow:0 7px 22px rgba(212,113,78,.28);font-family:'Noto Sans KR',sans-serif;margin-top:6px}
.save-btn:active{transform:scale(0.97)}

/* ë°©ëª…ë¡ */
#feed{background:#fdf8f2}
.feed-hd{padding:14px 20px;background:#fff;border-bottom:1.5px solid rgba(61,46,30,.06);flex-shrink:0}
.feed-ttl{font-family:'Nanum Myeongjo',serif;font-size:20px;color:var(--ink);font-weight:800}
.feed-sub{font-size:11px;color:var(--muted);margin-top:2px}
.gb-write{background:#fff;border-radius:20px;padding:16px;box-shadow:0 3px 14px var(--shadow);border:1.5px solid rgba(61,46,30,.04);margin-bottom:14px}
.gb-write-top{display:flex;align-items:center;gap:9px;margin-bottom:10px}
.gb-av-my{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#f5c9a0,#f4a96a);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.gb-write-nm{font-size:13px;font-weight:700;color:var(--ink)}
.gb-ta{width:100%;border:1.5px solid rgba(61,46,30,.1);border-radius:14px;padding:12px 14px;font-size:13px;color:var(--ink);font-family:'Noto Sans KR',sans-serif;outline:none;resize:none;min-height:72px;line-height:1.65;background:#fdfaf6;transition:border-color .2s}
.gb-ta:focus{border-color:var(--orange)}
.gb-ta::placeholder{color:#d4c4b4}
.gb-post-btn{background:linear-gradient(135deg,var(--terra),var(--orange));color:#fff;border:none;border-radius:14px;padding:9px 16px;font-size:12px;font-weight:700;cursor:pointer;font-family:'Noto Sans KR',sans-serif}
.gb-post-btn:active{transform:scale(0.96)}
.gb-card{background:#fff;border-radius:18px;padding:14px 16px;box-shadow:0 2px 10px var(--shadow);border:1.5px solid rgba(61,46,30,.04);animation:popIn .35s ease both}
.gb-hd{display:flex;align-items:center;gap:9px;margin-bottom:9px}
.gb-av{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#f5c9a0,#f4a96a);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.gb-nm{font-size:13px;font-weight:700;color:var(--ink)}
.gb-tm{font-size:10px;color:var(--muted);margin-top:1px}
.gb-txt{font-size:13px;color:var(--ink2);line-height:1.65;font-family:'Nanum Myeongjo',serif}
.gb-empty{text-align:center;padding:40px 20px;color:var(--muted)}

/* ë§ˆì´í˜ì´ì§€ */
#mypage{background:var(--cream)}
.my-hero{background:linear-gradient(160deg,#fdefd8,#fce0c0);padding:14px 20px 44px;position:relative;overflow:hidden;flex-shrink:0}
.my-hero::after{content:'';position:absolute;bottom:-18px;left:0;right:0;height:36px;background:var(--cream);border-radius:50% 50% 0 0 / 28px}
.my-deco{position:absolute;bottom:8px;right:8px;font-size:80px;opacity:.14;transform:scaleX(-1) rotate(10deg)}
.prof-row{display:flex;align-items:center;gap:13px;position:relative;z-index:1}
.prof-av{width:62px;height:62px;border-radius:50%;background:linear-gradient(135deg,#f5c9a0,#f4a96a);display:flex;align-items:center;justify-content:center;font-size:30px;border:3px solid #fff;box-shadow:0 4px 14px rgba(232,149,106,.28);flex-shrink:0}
.prof-nm{font-family:'Nanum Myeongjo',serif;font-size:20px;color:var(--ink);font-weight:800}
.prof-bio{font-size:11px;color:var(--ink2);margin-top:2px;line-height:1.4}
.prof-edit{background:#fff;border:1.5px solid rgba(61,46,30,.12);border-radius:18px;padding:7px 12px;font-size:11px;color:var(--ink2);cursor:pointer;font-weight:600;font-family:'Noto Sans KR',sans-serif;flex-shrink:0;margin-left:auto}
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:9px;margin:18px 16px 0}
.stat{background:#fff;border-radius:18px;padding:14px 8px;text-align:center;box-shadow:0 3px 12px var(--shadow)}
.stat-ico{font-size:16px;display:block;margin-bottom:5px}
.stat-num{font-family:'Nanum Myeongjo',serif;font-size:26px;color:var(--ink);font-weight:800;line-height:1;margin-bottom:4px}
.stat-num small{font-size:13px}
.stat-lbl{font-size:9px;color:var(--muted);font-weight:600}
.cal{margin:12px 16px 0;background:#fff;border-radius:20px;padding:16px;box-shadow:0 3px 12px var(--shadow)}
.cal-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.cal-ttl{font-family:'Nanum Myeongjo',serif;font-size:15px;color:var(--ink);font-weight:800}
.cal-nav{display:flex;gap:5px}
.cal-btn{width:26px;height:26px;background:#fef5ee;border:none;border-radius:9px;cursor:pointer;font-size:12px;color:var(--ink2);font-weight:700}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;text-align:center}
.cal-wl{font-size:9px;color:var(--muted);padding:2px 0;font-weight:600}
.cal-d{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:11px;color:var(--ink);border-radius:50%;font-weight:500}
.cal-d.done{background:var(--sage);color:#fff;font-weight:700}
.cal-d.today{box-shadow:0 0 0 2px var(--terra);font-weight:700;color:var(--terra)}
.cal-d.empty{color:#e0d0c0}
.my-menu{padding:12px 16px 20px;display:flex;flex-direction:column;gap:8px}
.mrow{background:#fff;border-radius:16px;padding:14px 16px;display:flex;align-items:center;gap:11px;cursor:pointer;box-shadow:0 2px 8px var(--shadow);transition:all .15s}
.mrow:active{transform:scale(0.99);background:#fef8f4}
.mico{font-size:20px;width:26px;text-align:center}
.mtxt{flex:1;font-size:13px;color:var(--ink);font-weight:600}
.marr{font-size:15px;color:var(--muted)}

/* ì˜¤ë²„ë ˆì´ & ì‹œíŠ¸ */
.overlay{position:fixed;inset:0;background:rgba(61,46,30,.44);z-index:50;opacity:0;pointer-events:none;transition:opacity .28s;backdrop-filter:blur(3px)}
.overlay.on{opacity:1;pointer-events:all}
.sheet{position:fixed;bottom:0;left:50%;transform:translateX(-50%) translateY(100%);width:100%;max-width:480px;background:var(--warm);border-radius:28px 28px 0 0;padding:0 20px calc(28px + env(safe-area-inset-bottom,0px));z-index:60;transition:transform .38s cubic-bezier(0.34,1.1,0.64,1);box-shadow:0 -10px 40px rgba(61,46,30,.14);max-height:90vh;overflow-y:auto}
.sheet::-webkit-scrollbar{display:none}
.sheet.on{transform:translateX(-50%) translateY(0)}
.s-handle{width:38px;height:4px;background:var(--peach);border-radius:2px;margin:12px auto 18px}
.s-ttl{font-family:'Nanum Myeongjo',serif;font-size:20px;color:var(--ink);font-weight:800;margin-bottom:4px}
.s-sub{font-size:11px;color:var(--muted);margin-bottom:20px}
.s-lbl{font-size:11px;color:var(--ink2);font-weight:700;letter-spacing:.06em;text-transform:uppercase;margin-bottom:7px}
.s-inp{width:100%;background:#fff;border:1.5px solid rgba(61,46,30,.1);border-radius:14px;padding:13px 15px;font-size:14px;color:var(--ink);font-family:'Noto Sans KR',sans-serif;outline:none;transition:border-color .2s;margin-bottom:14px}
.s-inp:focus{border-color:var(--orange)}
.s-inp::placeholder{color:#d4c4b4}
.sel-row{display:flex;gap:8px;margin-bottom:14px}
.sel-inp{flex:1;background:#fff;border:1.5px solid rgba(61,46,30,.1);border-radius:14px;padding:13px 15px;font-size:14px;color:var(--ink);font-family:'Noto Sans KR',sans-serif;outline:none;appearance:none;cursor:pointer;transition:border-color .2s}
.sel-inp:focus{border-color:var(--orange)}
.emoji-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:7px;margin-bottom:6px}
.emo-btn{aspect-ratio:1;background:#fff;border:2px solid rgba(61,46,30,.07);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:all .2s cubic-bezier(0.34,1.56,0.64,1)}
.emo-btn.sel{border-color:var(--orange);background:#fff4ee;transform:scale(1.14);box-shadow:0 3px 10px rgba(232,149,106,.2)}
.s-btn{width:100%;background:linear-gradient(135deg,var(--terra),var(--orange));color:#fff;border:none;border-radius:18px;padding:16px;font-size:15px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;box-shadow:0 7px 22px rgba(212,113,78,.28);margin-top:18px;font-family:'Noto Sans KR',sans-serif;transition:all .2s}
.s-btn:active{transform:scale(0.97)}
.s-btn.sage{background:linear-gradient(135deg,var(--sage),#7aad8a);box-shadow:0 7px 22px rgba(157,191,168,.3)}

/* ì‚­ì œ íŒì—… */
.popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.88);background:#fff;border-radius:24px;padding:26px 22px;width:min(82%,340px);z-index:70;box-shadow:0 18px 56px rgba(61,46,30,.2);text-align:center;opacity:0;pointer-events:none;transition:all .28s cubic-bezier(0.34,1.2,0.64,1)}
.popup.on{opacity:1;pointer-events:all;transform:translate(-50%,-50%) scale(1)}
.pop-ico{font-size:44px;margin-bottom:10px}
.pop-ttl{font-family:'Nanum Myeongjo',serif;font-size:18px;color:var(--ink);font-weight:800;margin-bottom:6px}
.pop-sub{font-size:12px;color:var(--muted);margin-bottom:18px;line-height:1.55}
.pop-btns{display:flex;gap:9px}
.pop-no{flex:1;background:#f5f0e8;border:none;border-radius:14px;padding:13px;font-size:13px;font-weight:700;color:var(--ink2);cursor:pointer;font-family:'Noto Sans KR',sans-serif}
.pop-yes{flex:1;background:var(--terra);border:none;border-radius:14px;padding:13px;font-size:13px;font-weight:700;color:#fff;cursor:pointer;font-family:'Noto Sans KR',sans-serif}

/* ê³µìœ  ì‹œíŠ¸ */
.code-box{background:#fff;border:1.5px solid rgba(61,46,30,.1);border-radius:14px;padding:13px 15px;display:flex;align-items:center;gap:9px;margin-bottom:7px}
.code-txt{flex:1;font-size:15px;color:var(--ink);font-weight:700;font-family:monospace;letter-spacing:.06em}
.copy-btn{background:var(--sage);color:#fff;border:none;border-radius:10px;padding:7px 12px;font-size:11px;font-weight:700;cursor:pointer;font-family:'Noto Sans KR',sans-serif;white-space:nowrap}
.code-hint{font-size:10.5px;color:var(--muted);line-height:1.6;margin-bottom:16px}
.div-line{display:flex;align-items:center;gap:8px;margin:14px 0}
.div-line::before,.div-line::after{content:'';flex:1;height:1.5px;background:rgba(61,46,30,.07)}
.div-line span{font-size:11px;color:var(--muted)}
.join-row{display:flex;gap:8px}
.join-inp{flex:1;background:#fff;border:1.5px solid rgba(61,46,30,.1);border-radius:14px;padding:13px 15px;font-size:13px;color:var(--ink);font-family:'Noto Sans KR',sans-serif;outline:none;transition:border-color .2s}
.join-inp:focus{border-color:var(--sage)}
.join-inp::placeholder{color:#d4c4b4;font-size:11px}
.join-btn{background:var(--sage);color:#fff;border:none;border-radius:14px;padding:13px 16px;font-size:13px;font-weight:700;cursor:pointer;font-family:'Noto Sans KR',sans-serif;white-space:nowrap}

/* ì˜¨ë³´ë”© */
.onboard{position:fixed;inset:0;background:linear-gradient(160deg,#fdefd8,#f8cba8);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:200;padding:32px 28px;text-align:center}
.onboard.hide{display:none}
.ob-cat{font-size:72px;margin-bottom:16px;animation:bob 3s ease-in-out infinite;display:inline-block}
.ob-ttl{font-family:'Nanum Myeongjo',serif;font-size:26px;color:var(--ink);font-weight:800;margin-bottom:8px}
.ob-sub{font-size:14px;color:var(--ink2);margin-bottom:32px;line-height:1.6}
.ob-inp{width:100%;background:#fff;border:2px solid rgba(61,46,30,.1);border-radius:18px;padding:16px 18px;font-size:16px;color:var(--ink);font-family:'Noto Sans KR',sans-serif;outline:none;text-align:center;margin-bottom:16px;box-shadow:0 4px 16px rgba(61,46,30,.08);transition:border-color .2s}
.ob-inp:focus{border-color:var(--orange)}
.ob-btn{width:100%;background:linear-gradient(135deg,var(--terra),var(--orange));color:#fff;border:none;border-radius:18px;padding:17px;font-size:16px;font-weight:700;cursor:pointer;box-shadow:0 8px 24px rgba(212,113,78,.3);font-family:'Noto Sans KR',sans-serif}

/* í† ìŠ¤íŠ¸ */
.toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%) translateY(10px);background:var(--ink);color:#fff;font-size:12.5px;font-weight:600;padding:11px 20px;border-radius:28px;white-space:nowrap;opacity:0;transition:all .28s cubic-bezier(0.34,1.56,0.64,1);z-index:999;pointer-events:none;box-shadow:0 7px 22px rgba(61,46,30,.24);max-width:90vw;text-align:center}
.toast.on{opacity:1;transform:translateX(-50%) translateY(0)}

@keyframes popIn{from{opacity:0;transform:translateY(12px) scale(0.97)}to{opacity:1;transform:translateY(0) scale(1)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.shake{animation:shake .28s ease}
</style>
</head>
<body>

<!-- ì˜¨ë³´ë”© -->
<div class="onboard" id="onboard">
  <div class="ob-cat">ğŸ±</div>
  <div class="ob-ttl">ë£¨ë‚˜ëƒ¥ì— ì˜¨ ê²ƒì„<br>í™˜ì˜í•´ìš”!</div>
  <div class="ob-sub">í•¨ê»˜ ë£¨í‹´ì„ ë§Œë“¤ì–´ê°ˆ ì´ë¦„ì„<br>ì•Œë ¤ì£¼ì„¸ìš” ğŸŒ¿</div>
  <input class="ob-inp" id="obInp" type="text" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ë´ìš”" maxlength="12">
  <button class="ob-btn" onclick="startApp()">ì‹œì‘í•˜ê¸° ğŸ¾</button>
</div>

<!-- ì•± -->
<div class="app" id="app" style="display:none">

  <!-- í™ˆ -->
  <div class="screen active" id="home">
    <div class="scroll-area">
      <div class="hero">
        <div class="hero-row">
          <div>
            <div class="hero-date" id="heroDate"></div>
            <div class="hero-name">ë°˜ê°€ì›Œìš”,<br><span id="nameHero">-</span>ë‹˜! ğŸŒ¿</div>
          </div>
          <div class="hero-cat" onclick="catTap(this)">ğŸ±</div>
        </div>
        <div class="prog-area">
          <div class="prog-row">
            <span class="prog-label">ì˜¤ëŠ˜ ë£¨í‹´ ë‹¬ì„±</span>
            <span class="prog-pct" id="progTxt">0/0</span>
          </div>
          <div class="prog-track"><div class="prog-fill" id="progFill"></div></div>
        </div>
      </div>
      <div class="ai-card">
        <div class="ai-emo">ğŸ±</div>
        <div style="flex:1">
          <div class="ai-badge">âœ¨ ì˜¤ëŠ˜ì˜ í•œ ë§ˆë””</div>
          <div class="ai-msg" id="quoteMsg"></div>
          <div style="font-size:10px;color:var(--muted);margin-top:5px" id="quoteAuthor"></div>
        </div>
      </div>
      <div class="sec-row">
        <div class="sec-title">ğŸ“‹ ì˜¤ëŠ˜ì˜ ë£¨í‹´</div>
        <button class="edit-btn" id="editBtn" onclick="toggleEdit()">âœï¸ í¸ì§‘</button>
      </div>
      <div class="r-list" id="rList"></div>
      <div class="add-btn" onclick="openSheet('addSheet')">
        <div class="add-ico">+</div>
        <div><div class="add-txt">ë£¨í‹´ ì¶”ê°€í•˜ê¸°</div><div class="add-sub">ë‚˜ë§Œì˜ ë£¨í‹´ì„ ë§Œë“¤ì–´ë´ìš” ğŸ¾</div></div>
      </div>
      <div class="share-banner" onclick="openSheet('shareSheet')">
        <div class="share-ico">ğŸ”—</div>
        <div class="share-info">
          <div class="share-ttl">ì¹œêµ¬ì™€ í•¨ê»˜ ë£¨í‹´í•˜ê¸°</div>
          <div class="share-sub">ì½”ë“œ í•˜ë‚˜ë¡œ ë£¨í‹´ ë³´ë“œ ê³µìœ !<br>ì•± ì—†ì´ ë°”ë¡œ ì‹œì‘í•´ìš” ğŸ¾</div>
        </div>
        <div style="font-size:16px;color:var(--sage)">â€º</div>
      </div>
    </div>
    <div class="bottom-nav">
      <div class="nav-item active" onclick="goTo('home')"><div class="nav-icon">ğŸ </div><div class="nav-label">í™ˆ</div></div>
      <div class="nav-item" onclick="goTo('record')"><div class="nav-icon">âœï¸</div><div class="nav-label">ê¸°ë¡</div></div>
      <div class="nav-item" onclick="goTo('feed')"><div class="nav-icon">ğŸ“–</div><div class="nav-label">ë°©ëª…ë¡</div></div>
      <div class="nav-item" onclick="goTo('mypage')"><div class="nav-icon">ğŸ¾</div><div class="nav-label">ë‚´ ë£¨í‹´</div></div>
    </div>
  </div>

  <!-- ê¸°ë¡ -->
  <div class="screen" id="record">
    <div class="rec-hero">
      <div class="rec-deco">ğŸ“</div>
      <div class="rec-lbl">Today's Record</div>
      <div class="rec-ttl">ì˜¤ëŠ˜ì„ ë‚¨ê²¨ìš” ğŸ±</div>
    </div>
    <div class="scroll-area" style="background:#fef5ee;padding:16px">
      <div class="inp-card">
        <div class="inp-lbl"><span>ğŸ”¥</span> ì˜¤ëŠ˜ì˜ ë‹¤ì§</div>
        <textarea class="txt-inp" placeholder="ì˜¤ëŠ˜ í•˜ë£¨, ë‚˜ì—ê²Œ ì „í•˜ëŠ” í•œ ë§ˆë””ë¥¼ ì¨ë´ìš”..." maxlength="100" oninput="document.getElementById('c1').textContent=this.value.length+' / 100'"></textarea>
        <div class="char-ct" id="c1">0 / 100</div>
      </div>
      <div class="inp-card">
        <div class="inp-lbl"><span>ğŸ’¬</span> ë£¨í‹´ ê¸°ë¡ ë©”ëª¨</div>
        <textarea class="txt-inp" placeholder="ì˜¤ëŠ˜ ë£¨í‹´ì„ í•˜ë©´ì„œ ì–´ë• ë‚˜ìš”?" maxlength="200" style="min-height:56px" oninput="document.getElementById('c2').textContent=this.value.length+' / 200'"></textarea>
        <div class="char-ct" id="c2">0 / 200</div>
      </div>
      <div class="inp-card">
        <div class="inp-lbl"><span>ğŸŒˆ</span> ì˜¤ëŠ˜ ë‚´ ê¸°ë¶„</div>
        <div class="mood-row">
          <div class="mood-btn" onclick="pickMood(this)">ğŸ˜Š<span>ì¢‹ìŒ</span></div>
          <div class="mood-btn" onclick="pickMood(this)">ğŸ˜¢<span>ìŠ¬í””</span></div>
          <div class="mood-btn" onclick="pickMood(this)">ğŸ˜ <span>í™”ë‚¨</span></div>
          <div class="mood-btn" onclick="pickMood(this)">ğŸ˜”<span>ìš°ìš¸</span></div>
          <div class="mood-btn" onclick="pickMood(this)">ğŸ˜<span>ê·¸ì €ê·¸ëŸ°</span></div>
        </div>
      </div>
      <button class="save-btn" onclick="showToast('ğŸ¾ ê¸°ë¡ì´ ì €ì¥ëì–´ìš”!');setTimeout(()=>goTo('home'),900)"><span>ğŸ¾</span> ê¸°ë¡ ë‚¨ê¸°ê¸°</button>
    </div>
    <div class="bottom-nav">
      <div class="nav-item" onclick="goTo('home')"><div class="nav-icon">ğŸ </div><div class="nav-label">í™ˆ</div></div>
      <div class="nav-item active" onclick="goTo('record')"><div class="nav-icon">âœï¸</div><div class="nav-label">ê¸°ë¡</div></div>
      <div class="nav-item" onclick="goTo('feed')"><div class="nav-icon">ğŸ“–</div><div class="nav-label">ë°©ëª…ë¡</div></div>
      <div class="nav-item" onclick="goTo('mypage')"><div class="nav-icon">ğŸ¾</div><div class="nav-label">ë‚´ ë£¨í‹´</div></div>
    </div>
  </div>

  <!-- ë°©ëª…ë¡ -->
  <div class="screen" id="feed">
    <div class="feed-hd"><div class="feed-ttl">ë°©ëª…ë¡ ğŸ“–</div><div class="feed-sub">í•¨ê»˜í•˜ëŠ” ì‚¬ëŒë“¤ì˜ ì´ì•¼ê¸°</div></div>
    <div class="scroll-area" style="padding:14px 16px">
      <div class="gb-write">
        <div class="gb-write-top">
          <div class="gb-av-my">ğŸ±</div>
          <div class="gb-write-nm" id="gbMyName">ë‚˜</div>
        </div>
        <textarea class="gb-ta" id="gbInput" placeholder="ì˜¤ëŠ˜ ë£¨í‹´ í•˜ë©´ì„œ ì–´ë• ë‚˜ìš”? í•œë§ˆë”” ë‚¨ê²¨ë´ìš” ğŸŒ¿" maxlength="150" oninput="document.getElementById('gbCount').textContent=this.value.length+' / 150'"></textarea>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <div style="font-size:11px;color:var(--muted)" id="gbCount">0 / 150</div>
          <button class="gb-post-btn" onclick="postGuestbook()">ë‚¨ê¸°ê¸° ğŸ¾</button>
        </div>
      </div>
      <div id="gbList" style="display:flex;flex-direction:column;gap:10px">
        <div class="gb-empty"><div style="font-size:36px;margin-bottom:8px">ğŸŒ¿</div><div style="font-size:13px;font-weight:600;color:var(--ink2)">ì•„ì§ ë°©ëª…ë¡ì´ ë¹„ì–´ìˆì–´ìš”</div><div style="font-size:11px;color:var(--muted);margin-top:4px">ì²« ë²ˆì§¸ ê¸€ì„ ë‚¨ê²¨ë´ìš”!</div></div>
      </div>
    </div>
    <div class="bottom-nav">
      <div class="nav-item" onclick="goTo('home')"><div class="nav-icon">ğŸ </div><div class="nav-label">í™ˆ</div></div>
      <div class="nav-item" onclick="goTo('record')"><div class="nav-icon">âœï¸</div><div class="nav-label">ê¸°ë¡</div></div>
      <div class="nav-item active" onclick="goTo('feed')"><div class="nav-icon">ğŸ“–</div><div class="nav-label">ë°©ëª…ë¡</div></div>
      <div class="nav-item" onclick="goTo('mypage')"><div class="nav-icon">ğŸ¾</div><div class="nav-label">ë‚´ ë£¨í‹´</div></div>
    </div>
  </div>

  <!-- ë‚´ ë£¨í‹´ (ë§ˆì´í˜ì´ì§€) -->
  <div class="screen" id="mypage">
    <div class="my-hero">
      <div class="my-deco">ğŸ±</div>
      <div class="prof-row">
        <div class="prof-av">ğŸ±</div>
        <div style="flex:1">
          <div class="prof-nm" id="nameProfile">-</div>
          <div class="prof-bio">ë§¤ì¼ ì¡°ê¸ˆì”©,<br>ë‚˜ë¥¼ ì°¾ì•„ê°€ëŠ” ì¤‘ ğŸŒ¿</div>
        </div>
        <button class="prof-edit" onclick="openSheet('nameSheet')">ì´ë¦„ ë³€ê²½ âœï¸</button>
      </div>
    </div>
    <div class="scroll-area">
      <div class="stats">
        <div class="stat"><span class="stat-ico">ğŸ”¥</span><div class="stat-num" id="streakStat">-<small>ì¼</small></div><div class="stat-lbl">ì—°ì† ë‹¬ì„±</div></div>
        <div class="stat"><span class="stat-ico">ğŸ“‹</span><div class="stat-num" id="totalStat">0</div><div class="stat-lbl">ì´ ë£¨í‹´ ìˆ˜</div></div>
        <div class="stat"><span class="stat-ico">âœ…</span><div class="stat-num" id="doneStat">0</div><div class="stat-lbl">ì˜¤ëŠ˜ ì™„ë£Œ</div></div>
      </div>
      <div class="cal">
        <div class="cal-hd"><div class="cal-ttl" id="calTitle">ğŸ—“</div><div class="cal-nav"><button class="cal-btn" onclick="changeMonth(-1)">â€¹</button><button class="cal-btn" onclick="changeMonth(1)">â€º</button></div></div>
        <div class="cal-grid" id="calGrid"></div>
      </div>
      <div class="my-menu">
        <div class="mrow" onclick="goTo('home');setTimeout(()=>openSheet('shareSheet'),120)"><div class="mico">ğŸ”—</div><div class="mtxt">ì¹œêµ¬ì™€ ë£¨í‹´ ê³µìœ í•˜ê¸°</div><div class="marr">â€º</div></div>
        <div class="mrow" onclick="openSheet('nameSheet')"><div class="mico">âœï¸</div><div class="mtxt">ì´ë¦„ ë³€ê²½í•˜ê¸°</div><div class="marr">â€º</div></div>
        <div class="mrow" onclick="showToast('ğŸ”” ì•Œë¦¼ ì„¤ì • ì¤€ë¹„ ì¤‘!')"><div class="mico">ğŸ””</div><div class="mtxt">ì•Œë¦¼ ì„¤ì •</div><div class="marr">â€º</div></div>
      </div>
    </div>
    <div class="bottom-nav">
      <div class="nav-item" onclick="goTo('home')"><div class="nav-icon">ğŸ </div><div class="nav-label">í™ˆ</div></div>
      <div class="nav-item" onclick="goTo('record')"><div class="nav-icon">âœï¸</div><div class="nav-label">ê¸°ë¡</div></div>
      <div class="nav-item" onclick="goTo('feed')"><div class="nav-icon">ğŸ“–</div><div class="nav-label">ë°©ëª…ë¡</div></div>
      <div class="nav-item active" onclick="goTo('mypage')"><div class="nav-icon">ğŸ¾</div><div class="nav-label">ë‚´ ë£¨í‹´</div></div>
    </div>
  </div>

</div><!-- /app -->

<!-- ì˜¤ë²„ë ˆì´ -->
<div class="overlay" id="overlay" onclick="closeAll()"></div>

<!-- ë£¨í‹´ ì¶”ê°€ ì‹œíŠ¸ -->
<div class="sheet" id="addSheet">
  <div class="s-handle"></div>
  <div class="s-ttl">ë£¨í‹´ ì¶”ê°€í•˜ê¸° ğŸ¾</div>
  <div class="s-sub">ë‚˜ë§Œì˜ ë£¨í‹´ì„ ì§ì ‘ ë§Œë“¤ì–´ë´ìš”!</div>
  <div class="s-lbl">ğŸ“ ë£¨í‹´ ì´ë¦„</div>
  <input class="s-inp" id="newName" type="text" placeholder="ì˜ˆ: ë¬¼ 2L ë§ˆì‹œê¸°, ìŠ¤íŠ¸ë ˆì¹­ 10ë¶„..." maxlength="20">
  <div class="s-lbl">ğŸ• ì‹œê°„</div>
  <div class="sel-row">
    <select class="sel-inp" id="newAmPm"><option>ì˜¤ì „</option><option>ì˜¤í›„</option></select>
    <select class="sel-inp" id="newHour">
      <option>6:00</option><option>7:00</option><option>8:00</option><option>9:00</option><option>10:00</option><option>11:00</option>
      <option>12:00</option><option>1:00</option><option>2:00</option><option>3:00</option><option>4:00</option><option>5:00</option>
      <option>6:00</option><option>7:00</option><option>8:00</option><option>9:00</option><option>10:00</option><option>11:00</option>
    </select>
  </div>
  <div class="s-lbl">âœ¨ ì´ëª¨ì§€</div>
  <div class="emoji-grid">
    <div class="emo-btn sel" onclick="pickEmo(this)">ğŸŒ¿</div><div class="emo-btn" onclick="pickEmo(this)">ğŸƒ</div>
    <div class="emo-btn" onclick="pickEmo(this)">ğŸ’§</div><div class="emo-btn" onclick="pickEmo(this)">ğŸµ</div>
    <div class="emo-btn" onclick="pickEmo(this)">ğŸ§˜</div><div class="emo-btn" onclick="pickEmo(this)">ğŸ’ª</div>
    <div class="emo-btn" onclick="pickEmo(this)">ğŸ“š</div><div class="emo-btn" onclick="pickEmo(this)">âœï¸</div>
    <div class="emo-btn" onclick="pickEmo(this)">ğŸŒ™</div><div class="emo-btn" onclick="pickEmo(this)">â˜•</div>
    <div class="emo-btn" onclick="pickEmo(this)">ğŸ¨</div><div class="emo-btn" onclick="pickEmo(this)">ğŸ§¹</div>
    <div class="emo-btn" onclick="pickEmo(this)">ğŸŒ¸</div><div class="emo-btn" onclick="pickEmo(this)">ğŸ</div>
    <div class="emo-btn" onclick="pickEmo(this)">ğŸš¶</div><div class="emo-btn" onclick="pickEmo(this)">ğŸ›</div>
    <div class="emo-btn" onclick="pickEmo(this)">ğŸŒ…</div><div class="emo-btn" onclick="pickEmo(this)">ğŸ““</div>
  </div>
  <button class="s-btn" onclick="saveRoutine()"><span>ğŸ¾</span> ë£¨í‹´ ì¶”ê°€í•˜ê¸°</button>
</div>

<!-- ì‚­ì œ íŒì—… -->
<div class="popup" id="delPopup">
  <div class="pop-ico">ğŸ—‘ï¸</div>
  <div class="pop-ttl">ì •ë§ ì‚­ì œí• ê¹Œìš”?</div>
  <div class="pop-sub" id="delMsg">ì´ ë£¨í‹´ì„ ì‚­ì œí•˜ë©´ ë³µêµ¬í•  ìˆ˜ ì—†ì–´ìš”.</div>
  <div class="pop-btns">
    <button class="pop-no" onclick="closeAll()">ì·¨ì†Œí• ê²Œìš”</button>
    <button class="pop-yes" onclick="doDelete()">ì‚­ì œí• ê²Œìš”</button>
  </div>
</div>

<!-- ê³µìœ  ì‹œíŠ¸ -->
<div class="sheet" id="shareSheet">
  <div class="s-handle"></div>
  <div class="s-ttl">ì¹œêµ¬ì™€ ë£¨í‹´í•˜ê¸° ğŸ”—</div>
  <div class="s-sub">ì½”ë“œ í•˜ë‚˜ë¡œ ë£¨í‹´ ë³´ë“œ ê³µìœ ! ì•± ì—†ì´ ë°”ë¡œ ì°¸ì—¬í•´ìš”.</div>
  <div class="s-lbl">ğŸ¾ ë‚´ ë£¨í‹´ë°© ì½”ë“œ</div>
  <div class="code-box">
    <div class="code-txt" id="myCode">-</div>
    <button class="copy-btn" onclick="copyCode()">ë³µì‚¬ ğŸ“‹</button>
  </div>
  <div class="code-hint">ì´ ì½”ë“œë¥¼ ì¹œêµ¬ì—ê²Œ ë³´ë‚´ë©´, ì¹œêµ¬ë„ ê°™ì€ ë£¨í‹´ ë³´ë“œì™€ ë°©ëª…ë¡ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆì–´ìš” ğŸŒ¿</div>
  <div class="div-line"><span>ë˜ëŠ” ì¹œêµ¬ ì½”ë“œë¡œ ì°¸ì—¬</span></div>
  <div class="s-lbl">ğŸŒ¿ ì¹œêµ¬ ë°© ì½”ë“œ ì…ë ¥</div>
  <div class="join-row">
    <input class="join-inp" id="joinInp" placeholder="ì¹œêµ¬ ì½”ë“œ ì…ë ¥ (ì˜ˆ: LUNA-AB1C2D)" maxlength="12">
    <button class="join-btn" onclick="joinRoom()">ì°¸ì—¬!</button>
  </div>
  <div id="joinedMsg" style="display:none;margin-top:14px;background:#eef6f2;border-radius:14px;padding:12px 14px;font-size:12px;color:var(--ink2);line-height:1.6"></div>
</div>

<!-- ì´ë¦„ ë³€ê²½ ì‹œíŠ¸ -->
<div class="sheet" id="nameSheet">
  <div class="s-handle"></div>
  <div style="text-align:center;padding:10px 0 18px">
    <div style="font-size:52px;margin-bottom:12px;display:inline-block;animation:bob 3s ease-in-out infinite">ğŸ±</div>
    <div class="s-ttl">ì´ë¦„ì„ ë°”ê¿”ë´ìš”!</div>
    <div class="s-sub">ì–¸ì œë“ ì§€ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš” ğŸŒ¿</div>
  </div>
  <div class="s-lbl">âœï¸ ìƒˆ ë‹‰ë„¤ì„</div>
  <input class="s-inp" id="newNameInp" type="text" placeholder="ìƒˆ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ë´ìš”" maxlength="12">
  <button class="s-btn" onclick="saveName()"><span>ğŸ¾</span> ì´ë¦„ ì €ì¥í•˜ê¸°</button>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â• STATE â•â•â•
let myName = '';
let editMode = false;
let deleteId = null;
window.routines = [];
window.gbPosts = [];
let calYear, calMonth;

// ëª…ì–¸
const quotes = [
  {msg:'ì‹œì‘ì´ ë°˜ì´ë‹¤. ì˜¤ëŠ˜ë„ ì¼ì–´ì„  ê²ƒë§Œìœ¼ë¡œ ì¶©ë¶„í•´ìš”.', author:'â€” ì•„ë¦¬ìŠ¤í† í…”ë ˆìŠ¤'},
  {msg:'ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„. ê·¸ëƒ¥ ê³„ì† í•˜ë©´ ë¼.', author:'â€” ë£¨ë‚˜ëƒ¥ ğŸ¾'},
  {msg:'ì–´ì œë³´ë‹¤ 1%ë§Œ ë‚˜ì•„ì§€ë©´, 1ë…„ í›„ì—” ì™„ì „íˆ ë‹¬ë¼ì ¸ ìˆì–´ìš”.', author:'â€” James Clear'},
  {msg:'ë‹¹ì‹ ì´ í•  ìˆ˜ ìˆë‹¤ê³  ë¯¿ë“ , ì—†ë‹¤ê³  ë¯¿ë“ , ë‹¹ì‹ ì´ ì˜³ì•„ìš”.', author:'â€” í—¨ë¦¬ í¬ë“œ'},
  {msg:'ì‘ì€ ìŠµê´€ì´ ì •ì²´ì„±ì„ ë§Œë“¤ê³ , ì •ì²´ì„±ì´ ì‚¶ì„ ë§Œë“¤ì–´ìš”.', author:'â€” James Clear'},
  {msg:'ì˜¤ëŠ˜ í˜ë“¤ì–´ë„ ê´œì°®ì•„. ê·¸ ìë¦¬ì— ìˆëŠ” ê²ƒë§Œìœ¼ë¡œë„ ëŒ€ë‹¨í•´ìš”.', author:'â€” ë£¨ë‚˜ëƒ¥ ğŸ¾'},
  {msg:'ì„±ê³µì€ ë§¤ì¼ì˜ ì‘ì€ ë…¸ë ¥ì´ ìŒ“ì¸ ê²°ê³¼ì˜ˆìš”.', author:'â€” ë¡œë²„íŠ¸ ì½œë¦¬ì–´'},
  {msg:'í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”. ì§€ê¸ˆ í˜ë“  ê±´ ëì´ ì•„ë‹ˆë¼ êµ½ì€ ê¸¸ì´ì—ìš”.', author:'â€” ë£¨ë‚˜ëƒ¥ ğŸ¾'},
  {msg:'ë‹¹ì‹ ì˜ ë£¨í‹´ì´ ê³§ ë‹¹ì‹ ì˜ ë¯¸ë˜ë¥¼ ë§Œë“¤ì–´ìš”.', author:'â€” ë£¨ë‚˜ëƒ¥ ğŸ¾'},
  {msg:'ì²œ ë¦¬ ê¸¸ë„ í•œ ê±¸ìŒë¶€í„°. ì˜¤ëŠ˜ ê·¸ í•œ ê±¸ìŒì„ ë‚´ë”›ì—ˆì–´ìš”.', author:'â€” ë…¸ì'},
  {msg:'ì§€ê¸ˆ ì´ ìˆœê°„ì— ì§‘ì¤‘í•˜ëŠ” ê²ƒ, ê·¸ê²Œ ê°€ì¥ ìš©ê°í•œ ì¼ì´ì—ìš”.', author:'â€” ë£¨ë‚˜ëƒ¥ ğŸ¾'},
  {msg:'ìê¸° ìì‹ ì„ ì´ê¸°ëŠ” ê²ƒì´ ê°€ì¥ ìœ„ëŒ€í•œ ìŠ¹ë¦¬ì˜ˆìš”.', author:'â€” í”Œë¼í†¤'},
  {msg:'ì˜¤ëŠ˜ í•˜ê¸° ì‹«ì–´ë„ í•˜ëŠ” ì‚¬ëŒì´, ë‚´ì¼ì„ ë°”ê¾¸ëŠ” ì‚¬ëŒì´ì—ìš”.', author:'â€” ë£¨ë‚˜ëƒ¥ ğŸ¾'},
  {msg:'ê³„ì† ë‹¤ì‹œ ì‹œì‘í•˜ëŠ” ì‚¬ëŒì´ ê°€ì¥ ì•„ë¦„ë‹¤ì›Œìš”.', author:'â€” ë£¨ë‚˜ëƒ¥ ğŸ¾'},
];

// ë°© ì½”ë“œ (ë‚´ ê³ ìœ  ì½”ë“œ)
const myRoomCode = 'LUNA-' + Math.random().toString(36).substr(2,6).toUpperCase();

// â•â•â• ì˜¨ë³´ë”© â•â•â•
function startApp() {
  const val = document.getElementById('obInp').value.trim();
  if (!val) {
    document.getElementById('obInp').classList.add('shake');
    setTimeout(() => document.getElementById('obInp').classList.remove('shake'), 300);
    return;
  }
  myName = val;
  setName(myName);
  document.getElementById('onboard').classList.add('hide');
  document.getElementById('app').style.display = 'flex';
  document.getElementById('myCode').textContent = myRoomCode;

  const d = new Date();
  calYear = d.getFullYear(); calMonth = d.getMonth();
  initDate();
  setDailyQuote();
  renderCal();

  // Firebase êµ¬ë… ì‹œì‘
  if (typeof fbInit === 'function') fbInit(myRoomCode.toLowerCase());
}

// â•â•â• ì´ë¦„ â•â•â•
function setName(name) {
  document.getElementById('nameHero').textContent = name;
  document.getElementById('nameProfile').textContent = name;
  const el = document.getElementById('gbMyName');
  if (el) el.textContent = name;
}
function saveName() {
  const val = document.getElementById('newNameInp').value.trim();
  if (!val) {
    document.getElementById('newNameInp').classList.add('shake');
    setTimeout(() => document.getElementById('newNameInp').classList.remove('shake'), 300);
    showToast('ì´ë¦„ì„ ì…ë ¥í•´ë´ìš” ğŸ¾'); return;
  }
  myName = val; setName(myName);
  document.getElementById('newNameInp').value = '';
  closeAll();
  showToast(`ğŸ¾ ì´ë¦„ì´ "${myName}"ìœ¼ë¡œ ë°”ë€Œì—ˆì–´ìš”!`);
}

// â•â•â• ë‚ ì§œ â•â•â•
function initDate() {
  const d = new Date();
  const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  document.getElementById('heroDate').textContent =
    `${d.getFullYear()}ë…„ ${String(d.getMonth()+1).padStart(2,'0')}ì›” ${String(d.getDate()).padStart(2,'0')}ì¼ ${days[d.getDay()]}ìš”ì¼`;
}

// â•â•â• ëª…ì–¸ â•â•â•
function setDailyQuote() {
  const q = quotes[new Date().getDate() % quotes.length];
  document.getElementById('quoteMsg').textContent = q.msg;
  document.getElementById('quoteAuthor').textContent = q.author;
}

// â•â•â• ë£¨í‹´ ë Œë” â•â•â•
window.renderRoutines = function() {
  const list = document.getElementById('rList');
  if (!list) return;
  const total = window.routines.length;
  const done = window.routines.filter(r => r.done).length;
  document.getElementById('progTxt').textContent = done + '/' + total;
  document.getElementById('progFill').style.width = (total ? Math.round(done/total*100) : 0) + '%';
  document.getElementById('totalStat').textContent = total;
  document.getElementById('doneStat').textContent = done;

  if (total === 0) {
    list.innerHTML = `<div style="text-align:center;padding:28px 16px;color:var(--muted)"><div style="font-size:44px;margin-bottom:10px">ğŸ¾</div><div style="font-size:14px;font-weight:600;color:var(--ink2);margin-bottom:5px">ë£¨í‹´ì´ ì•„ì§ ì—†ì–´ìš”!</div><div style="font-size:12px;line-height:1.6">ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì²« ë£¨í‹´ì„ ë§Œë“¤ì–´ë´ìš” ğŸŒ¿</div></div>`;
    return;
  }
  list.innerHTML = '';
  window.routines.forEach((r, i) => {
    const el = document.createElement('div');
    el.className = 'r-card' + (r.done ? ' done' : '') + (editMode ? ' edit-mode' : '');
    el.style.animationDelay = (i * 0.04) + 's';
    el.innerHTML = `
      <div class="r-chk">${r.done ? 'âœ“' : ''}</div>
      <div class="r-info">
        <div class="r-name">${r.name}</div>
        <div class="r-time">${r.time}${r.done ? ' Â· ì™„ë£Œ âœ“' : ' Â· ì•„ì§ì´ì—ìš”!'}</div>
      </div>
      <div class="r-emo">${r.emo}</div>
      <button class="r-del">ğŸ—‘ï¸</button>
    `;
    el.querySelector('.r-chk').addEventListener('click', () => { if (!editMode) toggleDone(r.id, r.done); });
    el.querySelector('.r-info').addEventListener('click', () => { if (!editMode) toggleDone(r.id, r.done); });
    el.querySelector('.r-del').addEventListener('click', e => { e.stopPropagation(); askDelete(r.id, r.name); });
    list.appendChild(el);
  });
}

// â•â•â• ì™„ë£Œ í† ê¸€ â•â•â•
function toggleDone(id, currentDone) {
  if (editMode) return;
  const newDone = !currentDone;
  if (typeof fbToggleDone === 'function') fbToggleDone(id, newDone);
  showToast(newDone ? 'ğŸ¾ ì™„ë£Œ! ì˜ í•˜ì…¨ì–´ìš”~' : 'â†©ï¸ ì™„ë£Œ ì·¨ì†Œí–ˆì–´ìš”');
}

// â•â•â• í¸ì§‘ ëª¨ë“œ â•â•â•
function toggleEdit() {
  editMode = !editMode;
  const btn = document.getElementById('editBtn');
  btn.textContent = editMode ? 'âœ… ì™„ë£Œ' : 'âœï¸ í¸ì§‘';
  btn.classList.toggle('on', editMode);
  window.renderRoutines();
  if (editMode) showToast('ğŸ—‘ï¸ ì‚­ì œí•  ë£¨í‹´ì˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ë´ìš”');
}

// â•â•â• ì‚­ì œ â•â•â•
function askDelete(id, name) {
  deleteId = id;
  document.getElementById('delMsg').textContent = `"${name}" ë£¨í‹´ì„ ì‚­ì œí•˜ë©´ ë³µêµ¬í•  ìˆ˜ ì—†ì–´ìš”.`;
  document.getElementById('overlay').classList.add('on');
  document.getElementById('delPopup').classList.add('on');
}
function doDelete() {
  if (typeof fbDeleteRoutine === 'function') fbDeleteRoutine(deleteId);
  deleteId = null;
  closeAll();
  showToast('ğŸ—‘ï¸ ë£¨í‹´ì´ ì‚­ì œëì–´ìš”');
}

// â•â•â• ë£¨í‹´ ì¶”ê°€ â•â•â•
function pickEmo(el) {
  document.querySelectorAll('.emo-btn').forEach(e => e.classList.remove('sel'));
  el.classList.add('sel');
}
function saveRoutine() {
  const name = document.getElementById('newName').value.trim();
  if (!name) {
    document.getElementById('newName').classList.add('shake');
    setTimeout(() => document.getElementById('newName').classList.remove('shake'), 300);
    showToast('ğŸ¾ ë£¨í‹´ ì´ë¦„ì„ ì…ë ¥í•´ë´ìš”!'); return;
  }
  const ampm = document.getElementById('newAmPm').value;
  const hour = document.getElementById('newHour').value;
  const emo = document.querySelector('.emo-btn.sel')?.textContent || 'ğŸŒ¿';
  if (typeof fbAddRoutine === 'function') fbAddRoutine(name, ampm + ' ' + hour, emo);
  document.getElementById('newName').value = '';
  document.querySelectorAll('.emo-btn').forEach(e => e.classList.remove('sel'));
  document.querySelector('.emo-btn').classList.add('sel');
  closeAll();
  showToast(`ğŸ¾ "${name}" ë£¨í‹´ì´ ì¶”ê°€ëì–´ìš”!`);
}

// â•â•â• ë°©ëª…ë¡ â•â•â•
window.renderGuestbook = function() {
  const list = document.getElementById('gbList');
  if (!list) return;
  if (window.gbPosts.length === 0) {
    list.innerHTML = `<div class="gb-empty"><div style="font-size:36px;margin-bottom:8px">ğŸŒ¿</div><div style="font-size:13px;font-weight:600;color:var(--ink2)">ì•„ì§ ë°©ëª…ë¡ì´ ë¹„ì–´ìˆì–´ìš”</div><div style="font-size:11px;color:var(--muted);margin-top:4px">ì²« ë²ˆì§¸ ê¸€ì„ ë‚¨ê²¨ë´ìš”!</div></div>`;
    return;
  }
  list.innerHTML = '';
  window.gbPosts.forEach((p, i) => {
    const card = document.createElement('div');
    card.className = 'gb-card';
    card.style.animationDelay = (i * 0.04) + 's';
    let timeStr = 'ë°©ê¸ˆ';
    if (p.createdAt && p.createdAt.toDate) {
      const d = p.createdAt.toDate();
      timeStr = `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
    }
    card.innerHTML = `<div class="gb-hd"><div class="gb-av">ğŸ±</div><div><div class="gb-nm">${p.name}</div><div class="gb-tm">ì˜¤ëŠ˜ ${timeStr}</div></div></div><div class="gb-txt">${p.text}</div>`;
    list.appendChild(card);
  });
}
function postGuestbook() {
  const txt = document.getElementById('gbInput').value.trim();
  if (!txt) { showToast('ğŸŒ¿ í•œë§ˆë”” ë‚¨ê²¨ë´ìš”!'); return; }
  if (typeof fbPostGuestbook === 'function') fbPostGuestbook(myName || 'ë‚˜', txt);
  document.getElementById('gbInput').value = '';
  document.getElementById('gbCount').textContent = '0 / 150';
  showToast('ğŸ¾ ë°©ëª…ë¡ì— ë‚¨ê²¨ì¡Œì–´ìš”!');
}

// â•â•â• ê³µìœ  â•â•â•
function copyCode() {
  const code = document.getElementById('myCode').textContent;
  if (navigator.clipboard) {
    navigator.clipboard.writeText(code).then(() => showToast('ğŸ”— ì½”ë“œ ë³µì‚¬ëì–´ìš”! ì¹œêµ¬ì—ê²Œ ë³´ë‚´ë´ìš”'));
  } else { showToast('ì½”ë“œ: ' + code); }
}
function joinRoom() {
  const code = document.getElementById('joinInp').value.trim().toUpperCase();
  if (!code) { showToast('ğŸŒ¿ ì¹œêµ¬ ì½”ë“œë¥¼ ì…ë ¥í•´ë´ìš”!'); return; }
  if (typeof fbJoinRoom === 'function') fbJoinRoom(code);
  document.getElementById('joinInp').value = '';
  const msg = document.getElementById('joinedMsg');
  msg.style.display = 'block';
  msg.innerHTML = `âœ… <b>${code}</b> ë°©ì— ì—°ê²°ëì–´ìš”!<br>ì´ì œ ë£¨í‹´ê³¼ ë°©ëª…ë¡ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í•¨ê»˜ ë³¼ ìˆ˜ ìˆì–´ìš” ğŸŒ¿`;
  showToast(`ğŸ”— ${code} ë°©ì— ì°¸ì—¬í–ˆì–´ìš”!`);
}

// â•â•â• ìº˜ë¦°ë” â•â•â•
function renderCal() {
  const d = new Date();
  const title = `ğŸ—“ ${calYear}ë…„ ${calMonth+1}ì›”`;
  document.getElementById('calTitle').textContent = title;
  const grid = document.getElementById('calGrid');
  grid.innerHTML = '';
  ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(w => {
    const wl = document.createElement('div'); wl.className = 'cal-wl'; wl.textContent = w; grid.appendChild(wl);
  });
  const firstDay = new Date(calYear, calMonth, 1).getDay();
  const lastDate = new Date(calYear, calMonth+1, 0).getDate();
  for (let i = 0; i < firstDay; i++) {
    const empty = document.createElement('div'); empty.className = 'cal-d empty'; empty.textContent = 'Â·'; grid.appendChild(empty);
  }
  for (let day = 1; day <= lastDate; day++) {
    const el = document.createElement('div'); el.className = 'cal-d';
    const isToday = day === d.getDate() && calMonth === d.getMonth() && calYear === d.getFullYear();
    if (isToday) el.classList.add('today');
    el.textContent = day; grid.appendChild(el);
  }
}
function changeMonth(dir) {
  calMonth += dir;
  if (calMonth < 0) { calMonth = 11; calYear--; }
  if (calMonth > 11) { calMonth = 0; calYear++; }
  renderCal();
}

// â•â•â• ë‚´ë¹„ â•â•â•
function goTo(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.bottom-nav').forEach(nav => {
    nav.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    const t = [...nav.querySelectorAll('.nav-item')].find(el => el.getAttribute('onclick')?.includes(`'${id}'`));
    if (t) t.classList.add('active');
  });
  if (id === 'feed') { const el = document.getElementById('gbMyName'); if (el) el.textContent = myName || 'ë‚˜'; }
  if (editMode) { editMode = false; document.getElementById('editBtn').textContent = 'âœï¸ í¸ì§‘'; document.getElementById('editBtn').classList.remove('on'); window.renderRoutines(); }
}
function openSheet(id) {
  closeAll(false);
  document.getElementById(id).classList.add('on');
  document.getElementById('overlay').classList.add('on');
  setTimeout(() => {
    if (id === 'addSheet') document.getElementById('newName').focus();
    if (id === 'nameSheet') document.getElementById('newNameInp').focus();
  }, 400);
}
function closeAll(closeOv = true) {
  document.querySelectorAll('.sheet').forEach(s => s.classList.remove('on'));
  document.getElementById('delPopup').classList.remove('on');
  if (closeOv) document.getElementById('overlay').classList.remove('on');
}

// â•â•â• ê¸°íƒ€ â•â•â•
function catTap(el) {
  const cats = ['ğŸ˜¸','ğŸ˜¹','ğŸ˜»','ğŸ˜º','ğŸ™€','ğŸ˜½'];
  el.textContent = cats[Math.floor(Math.random()*cats.length)];
  showToast('ëƒ¥ëƒ¥ ğŸ¾');
  setTimeout(() => el.textContent = 'ğŸ±', 1500);
}
function pickMood(el) {
  document.querySelectorAll('.mood-btn').forEach(m => m.classList.remove('sel'));
  el.classList.add('sel');
}

let _toast;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('on');
  clearTimeout(_toast);
  _toast = setTimeout(() => t.classList.remove('on'), 2400);
}

document.getElementById('obInp').addEventListener('keydown', e => { if (e.key === 'Enter') startApp(); });
</script>
</body>
</html>
